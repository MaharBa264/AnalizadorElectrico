{% extends "base.html" %}
{% block title %}Curvas IDMT{% endblock %}
{% block content %}
<div class="card p-3">
  <h5 class="mb-3">IDMT (IEC)</h5>
  <div class="row g-2">
    <div class="col-3"><label class="form-label">I<sub>f</sub> (A)</label><input id="I" class="form-control" type="number" value="1000"></div>
    <div class="col-3"><label class="form-label">I<sub>s</sub> (A)</label><input id="Is" class="form-control" type="number" value="200"></div>
    <div class="col-3"><label class="form-label">TMS</label><input id="TMS" class="form-control" type="number" step="0.01" value="0.1"></div>
    <div class="col-3">
      <label class="form-label">Curva</label>
      <select id="curve" class="form-select">
        <option value="standard">Standard</option>
        <option value="very">Very</option>
        <option value="extremely">Extremely</option>
        <option value="long">Long</option>
      </select>
    </div>
  </div>
  <div class="mt-3">
    <button class="btn btn-primary btn-sm" id="btn">Calcular t</button>
    <span class="ms-2" id="out" class="fw-bold"></span>
  </div>
</div>
{% endblock %}
{% block extra_scripts %}
<script>
document.getElementById('btn').onclick = async () =>{
  const body = {
    I_fault: Number(document.getElementById('I').value||0),
    Is: Number(document.getElementById('Is').value||0),
    TMS: Number(document.getElementById('TMS').value||0),
    curve: document.getElementById('curve').value
  };
  const r = await fetch("{{ url_for('protections.idmt_calc') }}",{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(body)});
  const j = await r.json();
  document.getElementById('out').textContent = j.ok ? `t = ${j.t_trip_s.toFixed(3)} s (${j.curve})` : 'error';
};
</script>
{% endblock %}
